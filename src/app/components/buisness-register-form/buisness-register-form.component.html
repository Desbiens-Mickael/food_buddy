<div class="allboxes">
  <!-- Informations utilisateur form#1-->
  <div class="boxblock1">
    <div class="blockForm" *ngIf="currentStep === 1">
      <form
        *ngIf="userForm"
        [formGroup]="userForm"
        #myForm="ngForm"
        novalidate
        class="px-4"
      >
        <app-user-form [parentForm]="userForm"></app-user-form>
      </form>
    </div>

    <!-- Informations entreprise form#2 -->
    <div class="boxblock2">
      <div class="blockForm" *ngIf="currentStep === 2">
        <form [formGroup]="buisnessForm" class="px-4">
          <app-buisness-form [parentForm]="buisnessForm"></app-buisness-form>
        </form>
      </div>
    </div>

    <!-- Informations etablissement form#3 -->
    <div class="boxblock3">
      <div class="blockForm" *ngIf="currentStep === 3">
        <form [formGroup]="establishmentForm" class="px-4">
          <app-establishment-form
            [parentForm]="establishmentForm"
          ></app-establishment-form>
        </form>
      </div>
    </div>

    <!-- Informations adresse form#4 -->
    <div class="boxblock4">
      <div class="blockForm" *ngIf="currentStep === 4">
        <form [formGroup]="addressForm" class="px-4">
          <h6>Adresse de l'établissement</h6>
          <div class="field relative">
            <div class="control">
              <input
                class="input shadow-lg w-full m-top-input"
                autocomplete="off"
                type="text"
                id="adresse-input"
                placeholder="Recherchez votre adresse"
                name="adresse-input"
                (input)="filter($event)"
                (focus)="showSuggestions()"
                (blur)="hideSuggestions()"
              />
              <div class="absolute bottom-[-5px] left-0 w-full">
                <ul
                  *ngIf="suggestionsVisible"
                  (mousedown)="keepSuggestionsVisible = true"
                  (mouseup)="keepSuggestionsVisible = false"
                >
                  <li
                    *ngFor="let ville of filteredVilles"
                    (click)="selectAdress(ville)"
                    (keydown.enter)="selectAdress(ville)"
                    tabindex="0"
                  >
                    {{ ville.properties.label }}
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="control">
              <input
                class="input shadow-lg w-full m-top-input"
                type="text"
                placeholder="N° rue"
                formControlName="streetNumber"
                [ngClass]="
                  addressForm.get('streetNumber')?.invalid &&
                  (addressForm.get('streetNumber')?.dirty ||
                    addressForm.get('streetNumber')?.touched)
                    ? 'text-red-600 placeholder:text-red-600 ring-2 ring-red-600 outline-offset-2 focus-visible:outline-none focus:outline-none'
                    : 'outline-offset-2 focus-visible:outline-neutral-500 focus:outline-none'
                "
              />
            </div>
            <div
              *ngIf="
                addressForm.get('streetNumber')?.invalid &&
                (addressForm.get('streetNumber')?.dirty ||
                  addressForm.get('streetNumber')?.touched)
              "
              class="text-white bg-red-600 text-lg text-main font-semibold mt-1 rounded-md py-1"
            >
              <small
                class="error"
                *ngIf="addressForm.get('streetNumber')?.errors?.['required']"
                >Numéro de rue requis.</small
              >
            </div>
          </div>

          <div class="field">
            <div class="control">
              <input
                class="input shadow-lg w-full m-top-input"
                type="text"
                placeholder="Nom de la rue"
                formControlName="streetName"
                [ngClass]="
                  addressForm.get('streetName')?.invalid &&
                  (addressForm.get('streetName')?.dirty ||
                    addressForm.get('streetName')?.touched)
                    ? 'text-red-600 placeholder:text-red-600 ring-2 ring-red-600 outline-offset-2 focus-visible:outline-none focus:outline-none'
                    : 'outline-offset-2 focus-visible:outline-neutral-500 focus:outline-none'
                "
              />
            </div>
            <div
              *ngIf="
                addressForm.get('streetName')?.invalid &&
                (addressForm.get('streetName')?.dirty ||
                  addressForm.get('streetName')?.touched)
              "
              class="text-white bg-red-600 text-lg text-main font-semibold mt-1 rounded-md py-1"
            >
              <small
                class="error"
                *ngIf="addressForm.get('streetName')?.errors?.['required']"
                >Nom de la rue requis.</small
              >
            </div>
          </div>

          <div class="field">
            <div class="control">
              <input
                class="input shadow-lg w-full m-top-input"
                type="text"
                placeholder="Code postal"
                formControlName="zipCode"
                [ngClass]="
                  addressForm.get('zipCode')?.invalid &&
                  (addressForm.get('zipCode')?.dirty ||
                    addressForm.get('zipCode')?.touched)
                    ? 'text-red-600 placeholder:text-red-600 ring-2 ring-red-600 outline-offset-2 focus-visible:outline-none focus:outline-none'
                    : 'outline-offset-2 focus-visible:outline-neutral-500 focus:outline-none'
                "
              />
            </div>
            <div
              *ngIf="
                addressForm.get('zipCode')?.invalid &&
                (addressForm.get('zipCode')?.dirty ||
                  addressForm.get('zipCode')?.touched)
              "
              class="text-white bg-red-600 text-lg text-main font-semibold mt-1 rounded-md py-1"
            >
              <small
                class="error"
                *ngIf="addressForm.get('zipCode')?.errors?.['required']"
                >Code postal requis.</small
              >
            </div>
          </div>

          <div class="field">
            <div class="control">
              <input
                class="input shadow-lg w-full m-top-input"
                type="text"
                name="city"
                placeholder="Ville"
                formControlName="city"
                [ngClass]="
                  addressForm.get('city')?.invalid &&
                  (addressForm.get('city')?.dirty ||
                    addressForm.get('city')?.touched)
                    ? 'text-red-600 placeholder:text-red-600 ring-2 ring-red-600 outline-offset-2 focus-visible:outline-none focus:outline-none'
                    : 'outline-offset-2 focus-visible:outline-neutral-500 focus:outline-none'
                "
              />
            </div>
            <div
              *ngIf="
                addressForm.get('city')?.invalid &&
                (addressForm.get('city')?.dirty ||
                  addressForm.get('city')?.touched)
              "
              class="text-white bg-red-600 text-lg text-main font-semibold mt-1 rounded-md py-1"
            >
              <small
                class="error"
                *ngIf="addressForm.get('city')?.errors?.['required']"
                >Ville requise.</small
              >
            </div>
          </div>
        </form>
      </div>
      <!-- FIN adresse etablissement form#4 -->
      <div class="buttons">
        <button
          *ngIf="currentStep !== 1"
          class="button btn-warning"
          (click)="prevStep()"
        >
          Précédent
        </button>

        <button
          class="button btn-valid"
          (click)="currentStep === 4 ? createBuisness() : nextStep()"
          [ngClass]="{
            'cursor-not-allowed':
              (userForm.invalid && currentStep === 1) ||
              (buisnessForm.invalid && currentStep === 2) ||
              (establishmentForm.invalid && currentStep === 3) ||
              (addressForm.invalid && currentStep === 4),
          }"
          [disabled]="
            (userForm.invalid && currentStep === 1) ||
            (buisnessForm.invalid && currentStep === 2) ||
            (establishmentForm.invalid && currentStep === 3) ||
            (addressForm.invalid && currentStep === 4)
          "
        >
          {{ currentStep === 4 ? 'Créer mon compte' : 'Suivant' }}
        </button>
      </div>
    </div>
  </div>
</div>
